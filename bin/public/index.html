<!DOCTYPE html>
<html ng-app="dinoBadge">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>Disguise Data Controller - Call of Duty Mobile</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.red.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    .status-modal {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 1000;
      transition: opacity 0.3s ease-in-out;
    }
    .status-modal.ng-hide {
      opacity: 0;
    }
  </style>
  <script>
    var dinoBadge = angular.module('dinoBadge', []);
    dinoBadge.controller('DinoController', function($scope, $interval, $timeout, socketService) {
      $scope.data = {
        leftTeam: '',
        rightTeam: '',
        selectedMap: '',
        leftColor: 'red',
        rightColor: 'blue',
        teams: [],
        champions: ''
      };
      $scope.rx = "TESTING";
      $scope.reloadEpoch = 1;
      $scope.maps = ['No Map','Summit', 'Apocalypse', 'Hacienda', 'HackenyYard', 'Standoff', 'Tunisia', 'FiringRange', 'Express', 'KurohanaMetropolis', 'Takeoff', 'Raid', 'Seaside', 'Arsenal'];
      $scope.updateStatus = '';
      $scope.showStatusModal = false;

      $interval(() => {
        $scope.rx = "TESTING" + $scope.reloadEpoch++;
      }, 1000);

      socketService.on('main', (data) => {
        $scope.data = data;
        console.log(data);
      });

      $scope.setTeam = (name, t) => {
        $scope.data[name] = t;
      };

      $scope.swapColors = () => {
        let temp = $scope.data.leftColor;
        $scope.data.leftColor = $scope.data.rightColor;
        $scope.data.rightColor = temp;
        socketService.emit('swapColors', $scope.data, (response) => {
          $scope.showUpdateStatus(response ? 'Colors swapped successfully' : 'Color swap failed');
        });
      };

      $scope.saveUpdates = () => {
        socketService.emit('main', $scope.data, (response) => {
          $scope.showUpdateStatus(response ? 'Updates saved successfully' : 'Update save failed');
        });
      };

      $scope.showUpdateStatus = (message) => {
        $scope.updateStatus = message;
        $scope.showStatusModal = true;
        $timeout(() => {
          $scope.showStatusModal = false;
        }, 2000);
      };
    });

    dinoBadge.factory('socketService', function($rootScope) {
      const socket = io();
      return {
        on: function(eventName, callback) {
          socket.on(eventName, function() {
            var args = arguments;
            $rootScope.$apply(function() {
              callback.apply(socket, args);
            });
          });
        },
        emit: function(eventName, data, callback) {
          socket.emit(eventName, data, function() {
            var args = arguments;
            $rootScope.$apply(function() {
              if (callback) {
                callback.apply(socket, args);
              }
            });
          });
        }
      };
    });
  </script>
</head>
<body ng-controller="DinoController">
  <div class="status-modal" ng-show="showStatusModal">
    {{updateStatus}}
  </div>
  <main class="container">
    <h1>Disguise Data Controller - Call of Duty Mobile</h1>
    <section>
      <h5>Team Selection</h5>
      <div class="grid">
        <div>
          <label>
            Stage Left Team
            <details class="dropdown">
              <summary>{{data.leftTeam || 'Select Left Team'}}</summary>
              <ul>
                <li ng-repeat="t in data.teams">
                  <a href="#" ng-click="setTeam('leftTeam', t)">{{t}}</a>
                </li>
              </ul>
            </details>
          </label>
        </div>
        <div>
          <label>
            Stage Left Color
            <select ng-model="data.leftColor" ng-change="saveUpdates()">
              <option value="red">Red</option>
              <option value="blue">Blue</option>
            </select>
          </label>
        </div>
        <div>
          <label>
            Stage Right Team
            <details class="dropdown">
              <summary>{{data.rightTeam || 'Select Right Team'}}</summary>
              <ul>
                <li ng-repeat="t in data.teams">
                  <a href="#" ng-click="setTeam('rightTeam', t)">{{t}}</a>
                </li>
              </ul>
            </details>
          </label>
        </div>
        <div>
          <label>
            Stage Right Color
            <select ng-model="data.rightColor" ng-change="saveUpdates()">
              <option value="red">Red</option>
              <option value="blue">Blue</option>
            </select>
          </label>
        </div>
        <div>
          <button ng-click="swapColors()">Swap Colors</button>
        </div>
      </div>
    </section>
    <section>
      <h5>Map Selection</h5>
      <div class="grid">
        <div>
          <label>
            Map
            <details class="dropdown">
              <summary>{{data.selectedMap || 'Select Map'}}</summary>
              <ul>
                <li ng-repeat="map in maps">
                  <a href="#" ng-click="data.selectedMap = map;">{{map}}</a>
                </li>
              </ul>
            </details>
          </label>
        </div>
      </div>
    </section>
    <section>
      <h5>Champions Selection</h5>
      <div class="grid">
        <div>
          <label>
            Champions
            <details class="dropdown">
              <summary>{{data.champions || 'Select Champions'}}</summary>
              <ul>
                <li ng-repeat="t in data.teams">
                  <a href="#" ng-click="data.champions = t;">{{t}}</a>
                </li>
              </ul>
            </details>
          </label>
        </div>
      </div>
    </section>
    <section>
      <button ng-click="saveUpdates()">Save Updates</button>
    </section>
  </main>
</body>
</html>
